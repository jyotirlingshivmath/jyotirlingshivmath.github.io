<!DOCTYPE html>
<html>
<head>
    <title>Shivmath Login</title>
    <style>
        body { font-family: Arial; max-width: 400px; margin: 100px auto; padding: 20px; background: #f0f8ff; }
        .login-form { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #45a049; }
        .error { color: red; margin: 10px 0; }
        #dashboard { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <div id="loginForm" class="login-form">
        <h2>üåü Shivmath Login</h2>
        <div id="errorMsg" class="error"></div>
        <input type="email" id="email" placeholder="admin@shivmath.in">
        <input type="password" id="password" placeholder="123456">
        <button onclick="handleLogin()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        <p style="text-align: center; color: #666;">Test: admin@shivmath.in | 123456</p>
    </div>

    <div id="dashboard" class="login-form">
        <h2 id="welcomeMsg">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!</h2>
        <p><strong>Organisation:</strong> <span id="orgName"></span></p>
        <p><strong>Role:</strong> <span id="userRole"></span></p>
        <h3>üìä Records:</h3>
        <div id="records"></div>
        <button onclick="addRecord()">‚ûï ‡§®‡§Ø‡§æ Record</button>
        <button onclick="refreshRecords()">üîÑ Refresh</button>
        <button onclick="logout()" style="background: #f44336;">üö™ Logout</button>
    </div>

    <script>
        // üö® YE EXACT URL DAALO (aapka working URL)
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxUU5v9eqHDbcfd33u4dLHkcY4LqD3OEELHzVzuJp2gmfUK4aaC2oiu_37_Nj2qBL1w/exec';

        function handleLogin() {
            document.getElementById('errorMsg').innerText = '';
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!email || !password) {
                document.getElementById('errorMsg').innerText = 'Email ‡§î‡§∞ Password ‡§≠‡§∞‡•á‡§Ç!';
                return;
            }

            // DEBUG: Console me check karo
            console.log('Login attempt:', email);

            fetch(BACKEND_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'login',
                    email: email,
                    password: password
                })
            })
            .then(response => response.text())
            .then(text => {
                console.log('Raw response:', text); // DEBUG
                const result = JSON.parse(text);
                
                if (result.success) {
                    localStorage.setItem('token', result.token);
                    localStorage.setItem('org', result.org);
                    localStorage.setItem('role', result.role);
                    
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    document.getElementById('welcomeMsg').innerText = '‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à ' + email;
                    document.getElementById('orgName').innerText = result.org;
                    document.getElementById('userRole').innerText = result.role;
                    
                    refreshRecords();
                } else {
                    document.getElementById('errorMsg').innerText = result.msg || 'Login failed';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('errorMsg').innerText = 'Network error: ' + error;
            });
        }

        function refreshRecords() {
            const token = localStorage.getItem('token');
            fetch(BACKEND_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'getData', token: token })
            })
            .then(r => r.text())
            .then(text => {
                const result = JSON.parse(text);
                if (result.success && result.data) {
                    let html = '<table><tr><th>ID</th><th>Name</th><th>Date</th><th>Status</th></tr>';
                    result.data.forEach(row => {
                        html += `<tr><td>${row[0] || ''}</td><td>${row[1] || ''}</td><td>${row[2] || ''}</td><td>${row[3] || ''}</td></tr>`;
                    });
                    html += '</table>';
                    document.getElementById('records').innerHTML = html || 'No records found';
                }
            });
        }

        function addRecord() {
            const token = localStorage.getItem('token');
            const id = prompt('ID:');
            const name = prompt('Name:');
            const status = prompt('Status (Active/Inactive):');
            
            if (id && name && status) {
                fetch(BACKEND_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'addData',
                        token: token,
                        id: id,
                        name: name,
                        status: status
                    })
                })
                .then(r => r.text())
                .then(text => {
                    const result = JSON.parse(text);
                    if (result.success) {
                        alert('‚úÖ Record added!');
                        refreshRecords();
                    } else {
                        alert('‚ùå ' + result.msg);
                    }
                });
            }
        }

        function logout() {
            localStorage.clear();
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        // Enter key support
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginForm').style.display !== 'none') {
                handleLogin();
            }
        });
    </script>
</body>
</html>
