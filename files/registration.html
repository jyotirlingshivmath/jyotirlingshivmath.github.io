<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admission Form | SHIVMATH VEDIC VIDYALAYA</title>

<style>
body{font-family:Times New Roman;background:#f2f2f2;}
.form{background:#fff;padding:15px;border:2px solid #000;max-width:900px;margin:auto;}
.header{text-align:center;border-bottom:2px solid #000;margin-bottom:10px;}
table{width:100%;border-collapse:collapse;}
td{border:1px solid #000;padding:6px;}
.label{font-weight:bold;}
.section{background:#eee;font-weight:bold;text-align:center;}
input,select,textarea{width:100%;border:none;outline:none;}
.photo{width:120px;height:140px;border:1px solid #000;text-align:center;}
button{margin:10px;padding:6px 15px;font-size:14px;}
</style>
</head>

<body>

<h2 style="text-align:center;color:green;">
✅ REGISTRATION PAGE LOADED
</h2>

<form id="admissionForm">
<div class="form">

<div class="header">
<h2>SHIVMATH VEDIC VIDYALAYA</h2>
<h3>ADMISSION / REGISTRATION FORM</h3>
</div>

<table>
<tr>
<td class="label">Admission No</td>
<td><input id="admno" readonly></td>
<td class="label">Date</td>
<td><input type="date" id="admdate"></td>
<td rowspan="4">
<div class="photo">
Photo<br>
<input type="file" id="photo">
<img id="photoPreview" style="width:100%;height:100%;">
</div>
</td>
</tr>

<tr>
<td class="label">Student Name</td>
<td colspan="3"><input id="name" required></td>
</tr>

<tr>
<td class="label">Gender</td>
<td>
<select id="gender">
<option>Male</option><option>Female</option><option>Other</option>
</select>
</td>
<td class="label">DOB</td>
<td><input type="date" id="dob"></td>
</tr>

<tr>
<td class="label">Category</td>
<td><input id="category"></td>
<td class="label">Blood Group</td>
<td><input id="blood"></td>
</tr>

<tr><td colspan="5" class="section">PARENT DETAILS</td></tr>

<tr>
<td class="label">Father</td>
<td><input id="father"></td>
<td class="label">Occupation</td>
<td colspan="2"><input id="fatherocc"></td>
</tr>

<tr>
<td class="label">Mother</td>
<td><input id="mother"></td>
<td class="label">Occupation</td>
<td colspan="2"><input id="motherocc"></td>
</tr>

<tr>
<td class="label">Mobile</td>
<td><input id="contact"></td>
<td class="label">Email</td>
<td colspan="2"><input id="email"></td>
</tr>

<tr><td colspan="5" class="section">ADDRESS</td></tr>
<tr><td colspan="5"><textarea id="address"></textarea></td></tr>

<tr><td colspan="5" class="section">ACADEMIC</td></tr>
<tr>
<td class="label">Class</td>
<td><input id="studentClass"></td>
<td class="label">Previous School</td>
<td colspan="2"><input id="prevSchool"></td>
</tr>

</table>
</div>

<center>
<button type="submit">Save Admission</button>
<button type="button" onclick="window.print()">Print</button>
</center>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {

  console.log("SCRIPT RUNNING OK");

  const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbwZuYa-ubbOiML3TdVIaqbs96ClcKi5VvTeO5jNMTgMrxQVYLk0rMe9J8HHfth0-w4/exec";

  const admno = document.getElementById("admno");
  const admdate = document.getElementById("admdate");
  const photo = document.getElementById("photo");
  const photoPreview = document.getElementById("photoPreview");
  const form = document.getElementById("admissionForm");

  let lastAdm = parseInt(localStorage.getItem("lastAdm")) || 3000;
  admno.value = ++lastAdm;
  localStorage.setItem("lastAdm", lastAdm);

  admdate.value = new Date().toISOString().slice(0,10);

  let photoData = "";
  photo.addEventListener("change", e => {
    const r = new FileReader();
    r.onload = () => { photoPreview.src = r.result; photoData = r.result; };
    r.readAsDataURL(e.target.files[0]);
  });

  form.addEventListener("submit", function(e){
    e.preventDefault();

    const data = {
      admno: admno.value,
      student_name: name.value,
      gender: gender.value,
      dob: dob.value,
      category: category.value,
      blood_group: blood.value,
      father_name: father.value,
      father_occ: fatherocc.value,
      mother_name: mother.value,
      mother_occ: motherocc.value,
      mobile: contact.value,
      email: email.value,
      address: address.value,
      class_name: studentClass.value,
      prev_school: prevSchool.value,
      photo: photoData,
      timestamp: new Date().toISOString()
    };

    fetch(WEB_APP_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(data)
    })
    .then(r=>r.json())
    .then(res=>alert("✅ Saved Successfully"))
    .catch(err=>alert("❌ Script Error"));

    form.reset();
    photoPreview.src="";
    admno.value = ++lastAdm;
    localStorage.setItem("lastAdm", lastAdm);
  });

});
</script>

</body>
</html>
