<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admission Form</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 300px; padding: 5px; margin-top: 5px; }
    #photoPreview { margin-top: 10px; width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>

<h2>Admission Form</h2>

<form id="admissionForm">
  <label>Admission No: <input type="text" id="admno" readonly></label>
  <label>Admission Date: <input type="date" id="admdate" readonly></label>
  <label>Name: <input type="text" id="name" required></label>
  <label>Gender: 
    <select id="gender" required>
      <option value="">Select</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>
  </label>
  <label>Date of Birth: <input type="date" id="dob" required></label>
  <label>Category: <input type="text" id="category"></label>
  <label>Blood Group: <input type="text" id="blood"></label>
  <label>Father's Name: <input type="text" id="father"></label>
  <label>Father's Occupation: <input type="text" id="fatherocc"></label>
  <label>Mother's Name: <input type="text" id="mother"></label>
  <label>Mother's Occupation: <input type="text" id="motherocc"></label>
  <label>Mobile: <input type="tel" id="contact"></label>
  <label>Email: <input type="email" id="email"></label>
  <label>Address: <input type="text" id="address"></label>
  <label>Class: <input type="text" id="studentClass"></label>
  <label>Previous School: <input type="text" id="prevSchool"></label>
  <label>Photo: <input type="file" id="photo" accept="image/*"></label>
  <img id="photoPreview" src="" alt="Photo Preview">
  <button type="submit">Submit</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyvpfXNi_HCaNQHSSP72KrEJXkpiZKAkmxw_su1nYm42v4Co2lLW2qyGV-GjA6MVJ9D/exec";

  const form = document.getElementById("admissionForm");
  const admno = document.getElementById("admno");
  const admdate = document.getElementById("admdate");
  const photo = document.getElementById("photo");
  const photoPreview = document.getElementById("photoPreview");

  // Initialize Admission Number
  let lastAdm = parseInt(localStorage.getItem("lastAdm")) || 3000;
  admno.value = ++lastAdm;
  localStorage.setItem("lastAdm", lastAdm);

  // Set current date
  admdate.value = new Date().toISOString().slice(0,10);

  // Handle photo preview
  let photoData = "";
  photo.addEventListener("change", function(e) {
    if(e.target.files && e.target.files[0]) {
      const reader = new FileReader();
      reader.onload = function(event) {
        photoPreview.src = event.target.result;
        photoData = event.target.result;
      }
      reader.readAsDataURL(e.target.files[0]);
    }
  });

  // Form submission
  form.addEventListener("submit", function(e){
    e.preventDefault();

    const data = {
      timestamp: new Date().toISOString(),
      admno: admno.value,
      student_name: document.getElementById("name").value,
      gender: document.getElementById("gender").value,
      dob: document.getElementById("dob").value,
      category: document.getElementById("category").value,
      blood_group: document.getElementById("blood").value,
      father_name: document.getElementById("father").value,
      father_occ: document.getElementById("fatherocc").value,
      mother_name: document.getElementById("mother").value,
      mother_occ: document.getElementById("motherocc").value,
      mobile: document.getElementById("contact").value,
      email: document.getElementById("email").value,
      address: document.getElementById("address").value,
      class_name: document.getElementById("studentClass").value,
      prev_school: document.getElementById("prevSchool").value,
      photo: photoData
    };

    fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      if(res.success){
        alert("✅ Admission Saved & Sheet Updated");
      } else {
        alert("❌ Sheet Error. Check Apps Script URL");
      }
    })
    .catch(err => {
      console.error(err);
      alert("❌ Script Error. See console for details");
    });

    // Reset form
    form.reset();
    photoPreview.src = "";
    admno.value = ++lastAdm;
    localStorage.setItem("lastAdm", lastAdm);
  });

});
</script>

</body>
</html>
