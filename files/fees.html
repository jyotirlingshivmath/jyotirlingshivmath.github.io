<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fee Management | ‡§∂‡§ø‡§µ‡§Æ‡§† ‡§µ‡•à‡§¶‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø</title>

<style>
body{
  font-family:Mukta,sans-serif;
  margin:0;
  background:#fff8e1;
}
.header{
  background:#ffecb3;
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  color:#4a148c;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h2{color:#4a148c;}
form{
  background:#fff3e0;
  padding:20px;
  border-radius:8px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
form select,form input,form button{
  padding:10px;
  border-radius:6px;
  border:1px solid #e1bee7;
  flex:1 1 200px;
}
button{
  background:#ffeb3b;
  font-weight:bold;
  border:none;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #e1bee7;
  padding:8px;
}
th{background:#ffecb3;}
.action-btn{padding:4px 8px;}
.edit-btn{background:#4a148c;color:#fff;}
.delete-btn{background:darkred;color:#fff;}

.receipt{
  display:none;
  background:white;
  padding:20px;
  border:1px solid #000;
}

@media print{
  body *{visibility:hidden;}
  .receipt, .receipt *{visibility:visible;}
  .receipt{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>

<body>

<div class="header">üî± Fee Management - ‡§∂‡§ø‡§µ‡§Æ‡§† ‡§µ‡•à‡§¶‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø üî±</div>

<div class="container">

<h2>‡§´‡•Ä‡§∏ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç</h2>

<form id="feeForm">
  <select id="studentSelect" required>
    <option value="">‚Äî ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç ‚Äî</option>
  </select>

  <input type="number" id="amount" placeholder="‡§∞‡§æ‡§∂‡§ø (‚Çπ)" required>
  <input type="date" id="date" required>

  <input type="hidden" id="editIndex">
  <button type="submit">‡§´‡•Ä‡§∏ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
</form>

<input id="searchInput" placeholder="‡§®‡§æ‡§Æ / ‡§Æ‡§π‡•Ä‡§®‡§æ / ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç">

<h2>‡§´‡•Ä‡§∏ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°</h2>

<table>
<thead>
<tr>
<th>#</th>
<th>‡§õ‡§æ‡§§‡•ç‡§∞</th>
<th>‡§∞‡§æ‡§∂‡§ø</th>
<th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
<th>Action</th>
</tr>
</thead>
<tbody id="feeTable"></tbody>
</table>

<h2>üìä ‡§õ‡§æ‡§§‡•ç‡§∞-‡§µ‡§æ‡§∞ ‡§ï‡•Å‡§≤ ‡§´‡•Ä‡§∏</h2>
<table>
<thead>
<tr><th>‡§õ‡§æ‡§§‡•ç‡§∞</th><th>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)</th></tr>
</thead>
<tbody id="summaryTable"></tbody>
</table>

</div>

<!-- RECEIPT -->
<div class="receipt" id="receipt">
  <h2 style="text-align:center;">‡§∂‡§ø‡§µ‡§Æ‡§† ‡§µ‡•à‡§¶‡§ø‡§ï ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§≤‡§Ø</h2>
  <hr>
  <p><b>‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ:</b> <span id="rName"></span></p>
  <p><b>‡§∞‡§æ‡§∂‡§ø:</b> ‚Çπ <span id="rAmount"></span></p>
  <p><b>‡§§‡§æ‡§∞‡•Ä‡§ñ:</b> <span id="rDate"></span></p>
  <p><b>‡§∞‡§∏‡•Ä‡§¶ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</b> <span id="rNo"></span></p>
  <br>
  <p>‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞: ____________</p>
</div>

<script>
// LOAD DATA
let students = JSON.parse(localStorage.getItem("students")) || [];
let fees = JSON.parse(localStorage.getItem("fees")) || [];

const studentSelect=document.getElementById("studentSelect");
const feeTable=document.getElementById("feeTable");
const summaryTable=document.getElementById("summaryTable");
const searchInput=document.getElementById("searchInput");
const editIndex=document.getElementById("editIndex");

// Populate students
students.forEach(s=>{
 let o=document.createElement("option");
 o.value=s.name;
 o.textContent=s.name;
 studentSelect.appendChild(o);
});

// Render fee table
function renderTable(data){
 feeTable.innerHTML="";
 data.forEach((f,i)=>{
  feeTable.innerHTML+=`
  <tr>
   <td>${i+1}</td>
   <td>${f.name}</td>
   <td>${f.amount}</td>
   <td>${f.date}</td>
   <td>
    <button class="action-btn edit-btn" onclick="editFee(${i})">Edit</button>
    <button class="action-btn delete-btn" onclick="deleteFee(${i})">Del</button>
    <button class="action-btn" onclick="printReceipt(${i})">Print</button>
   </td>
  </tr>`;
 });
}
renderTable(fees);

// Summary
function renderSummary(){
 let totals={};
 fees.forEach(f=>{
  totals[f.name]=(totals[f.name]||0)+Number(f.amount);
 });
 summaryTable.innerHTML="";
 for(let n in totals){
  summaryTable.innerHTML+=`
   <tr><td>${n}</td><td>${totals[n]}</td></tr>`;
 }
}
renderSummary();

// Submit
feeForm.onsubmit=e=>{
 e.preventDefault();
 let fee={
  name:studentSelect.value,
  amount:amount.value,
  date:date.value
 };
 if(editIndex.value!==""){
  fees[editIndex.value]=fee;
  editIndex.value="";
 }else{
  fees.push(fee);
 }
 localStorage.setItem("fees",JSON.stringify(fees));
 feeForm.reset();
 renderTable(fees);
 renderSummary();
};

// Edit/Delete
function editFee(i){
 let f=fees[i];
 studentSelect.value=f.name;
 amount.value=f.amount;
 date.value=f.date;
 editIndex.value=i;
}
function deleteFee(i){
 if(confirm("‡§π‡§ü‡§æ‡§è‡§Å?")){
  fees.splice(i,1);
  localStorage.setItem("fees",JSON.stringify(fees));
  renderTable(fees);
  renderSummary();
 }
}

// Search
searchInput.onkeyup=()=>{
 let q=searchInput.value.toLowerCase();
 renderTable(fees.filter(f=>
  f.name.toLowerCase().includes(q) ||
  f.date.includes(q)
 ));
};

// Print receipt
function printReceipt(i){
 let f=fees[i];
 rName.innerText=f.name;
 rAmount.innerText=f.amount;
 rDate.innerText=f.date;
 rNo.innerText="SMV-"+(i+1);
 window.print();
}
</script>

</body>
</html>
