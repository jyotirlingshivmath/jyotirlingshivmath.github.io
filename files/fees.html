<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>School Fees Receipt</title>

<style>
body{font-family:Arial;background:#f5f5f5;}
.container{width:800px;margin:20px auto;background:#fff;padding:20px;border:1px solid #000;}
h2,h3{text-align:center;margin:5px;}
.row{display:flex;justify-content:space-between;margin-bottom:10px;}
label{width:140px;font-weight:bold;}
input{width:200px;padding:5px;}
button{padding:8px 15px;margin-top:10px;}
@media print{
  button{display:none;}
  body{background:#fff;}
}
</style>
</head>

<body>
<div class="container">

<h2>JYOTIRLING SHIVMATH VADIC VIDYALAYA</h2>
<h3>FEES RECEIPT</h3>

<!-- SEARCH -->
<div class="row">
  <label>Admission No</label>
  <input type="text" id="searchAdm">
</div>

<div class="row">
  <label>Student Name</label>
  <input type="text" id="searchName">
</div>

<button onclick="searchStudent()">Search</button>

<hr>

<!-- STUDENT DETAILS -->
<div class="row">
  <label>Admission No</label>
  <input id="admno" readonly>
</div>

<div class="row">
  <label>Name</label>
  <input id="name" readonly>
</div>

<div class="row">
  <label>Class</label>
  <input id="class" readonly>
</div>

<div class="row">
  <label>Father Name</label>
  <input id="father" readonly>
</div>

<hr>

<!-- FEES DETAILS -->
<div class="row">
  <label>Receipt No</label>
  <input id="receipt">
</div>

<div class="row">
  <label>Month</label>
  <input id="month">
</div>

<div class="row">
  <label>Total Fees</label>
  <input id="total" oninput="calcRemain()">
</div>

<div class="row">
  <label>Paid Amount</label>
  <input id="paid" oninput="calcRemain()">
</div>

<div class="row">
  <label>Remaining</label>
  <input id="remain" readonly>
</div>

<button onclick="saveFees()">Save Fees</button>
<button onclick="window.print()">Print Receipt</button>

</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbzfZyqt7NBUhF7Ck9pcjkuji8jrea_iaF_r6RkEUFxOQFF1WG0xjoxWkm89zuuR2Bd4/exec";

  /* SEARCH STUDENT */
  window.searchStudent = function () {
    const adm = document.getElementById("searchAdm").value.trim();
    const nameVal = document.getElementById("searchName").value.trim();

    if (!adm && !nameVal) {
      alert("Enter Admission No or Student Name");
      return;
    }

    fetch(`${WEB_APP_URL}?admno=${encodeURIComponent(adm)}&student_name=${encodeURIComponent(nameVal)}`)
      .then(res => res.json())
      .then(d => {
        if (!d.success || d.data.length === 0) {
          alert("Student not found");
          return;
        }
        const s = d.data[0];
        admno.value = s.admno || "";
        name.value = s.student_name || "";
        class.value = s.class_name || "";
        father.value = s.father_name || "";
      })
      .catch(() => alert("Error fetching student data"));
  };

  /* CALCULATE REMAIN */
  window.calcRemain = function () {
    remain.value = (+total.value || 0) - (+paid.value || 0);
  };

  /* SAVE FEES (âœ… FIXED) */
  window.saveFees = function () {

    if (!admno.value) {
      alert("Select student first");
      return;
    }

    const payload = {
      action: "saveFees",
      data: {
        receipt: receipt.value || Date.now(),
        admno: admno.value,
        name: name.value,
        month: month.value,
        total: total.value,
        paid: paid.value,
        remain: remain.value
      }
    };

    fetch(WEB_APP_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(r => {
      if (r.success) {
        alert("Fees saved successfully");
      } else {
        alert("Fees not saved");
      }
    })
    .catch(() => alert("Server error while saving fees"));
  };

});
</script>

</body>
</html>
