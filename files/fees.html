<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>School Fees Receipt</title>

<style>
body{font-family:Arial;background:#f5f5f5;}
.container{width:800px;margin:20px auto;background:#fff;padding:20px;border:1px solid #000;}
h2,h3{text-align:center;margin:5px;}
.row{display:flex;justify-content:space-between;margin-bottom:10px;}
label{width:140px;font-weight:bold;}
input{width:200px;padding:5px;}
button{padding:8px 15px;margin-top:10px;}
@media print{
  button{display:none;}
  body{background:#fff;}
}
</style>
</head>

<body>
<div class="container">

<h2>JYOTIRLING SHIVMATH VADIC VIDYALAYA</h2>
<h3>FEES RECEIPT</h3>

<!-- SEARCH -->
<div class="row">
  <label>Admission No</label>
  <input type="text" id="searchAdm">
</div>

<div class="row">
  <label>Student Name</label>
  <input type="text" id="searchName">
</div>

<button onclick="searchStudent()">Search</button>

<hr>

<!-- STUDENT DETAILS -->
<div class="row">
  <label>Admission No</label>
  <input id="admno" readonly>
</div>

<div class="row">
  <label>Name</label>
  <input id="name" readonly>
</div>

<div class="row">
  <label>Class</label>
  <input id="class" readonly>
</div>

<div class="row">
  <label>Father Name</label>
  <input id="father" readonly>
</div>

<hr>

<!-- FEES DETAILS -->
<div class="row">
  <label>Receipt No</label>
  <input id="receipt">
</div>

<div class="row">
  <label>Month</label>
  <input id="month">
</div>

<div class="row">
  <label>Total Fees</label>
  <input id="total" oninput="calcRemain()">
</div>

<div class="row">
  <label>Paid Amount</label>
  <input id="paid" oninput="calcRemain()">
</div>

<div class="row">
  <label>Remaining</label>
  <input id="remain" readonly>
</div>

<button onclick="saveFees()">Save Fees</button>
<button onclick="window.print()">Print Receipt</button>

</div>

<script>
const WEB_APP_URL = "YOUR_WEB_APP_URL_HERE"; // replace with your deployed Apps Script URL

/* SEARCH STUDENT */
function searchStudent(){
  const adm = document.getElementById("searchAdm").value.trim();
  const name = document.getElementById("searchName").value.trim();

  if(!adm && !name){
    alert("Enter Admission No or Student Name to search");
    return;
  }

  fetch(`${WEB_APP_URL}?admno=${adm}&student_name=${name}`)
    .then(res=>res.json())
    .then(d=>{
      if(!d.success || d.data.length===0){
        alert("Student not found");
        admno.value=""; name.value=""; class.value=""; father.value="";
        return;
      }
      const student = d.data[0];
      admno.value = student.admno;
      name.value = student.student_name;
      class.value = student.class_name || "";
      father.value = student.father_name || "";
    })
    .catch(err=>{
      console.error(err);
      alert("Error fetching student data");
    });
}

/* CALCULATE REMAINING */
function calcRemain(){
  const t = +total.value||0;
  const p = +paid.value||0;
  remain.value = t - p;
}

/* SAVE FEES */
function saveFees(){
  if(!admno.value){
    alert("Please select a student first");
    return;
  }

  const data = {
    receipt: receipt.value || new Date().getTime(),
    admno: admno.value,
    name: name.value,
    month: month.value,
    total: total.value,
    paid: paid.value,
    remain: remain.value
  };

  google.script.run.withSuccessHandler(function(msg){
    alert(msg);
    // clear form except student details
    receipt.value=""; month.value=""; total.value=""; paid.value=""; remain.value="";
  }).saveFeesData(data);
}
</script>

</body>
</html>
