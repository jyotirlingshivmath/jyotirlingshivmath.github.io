<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Fee Collection</title>

<style>
body { font-family: Arial; background:#f0f0f0; }
.box {
  width:550px; margin:20px auto; background:#fff;
  padding:20px; border-radius:8px;
}
select, input, button {
  width:100%; padding:8px; margin:8px 0;
}
button { background:#0066cc; color:white; border:none; }

/* ===== SUMMARY ===== */
.summary {
  margin-top:15px;
  padding:10px;
  background:#e8f5e9;
  border:2px solid green;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}

/* ===== RECEIPT STYLE ===== */
#receipt {
  display:none;
  width:520px;
  margin:auto;
  border:2px solid black;
  padding:15px;
}
#receipt h2 {
  text-align:center;
  margin:5px 0;
}
.row {
  display:flex;
  justify-content:space-between;
  margin:6px 0;
}
hr { border:1px solid black; }

@media print {
  body * { visibility:hidden; }
  #receipt, #receipt * {
    visibility:visible;
  }
  #receipt {
    position:absolute;
    top:0; left:0;
  }
}
</style>

</head>
<body>

<div class="box">
<h2>Fee Collection</h2>

<select id="studentSelect"></select>

<input type="number" id="amount" placeholder="Fee Amount">
<input type="text" id="month" placeholder="Month">

<button onclick="generateReceipt()">Generate Receipt</button>

<div class="summary">
Grand Total Fees Collected: ₹ <span id="grandTotal">0</span>
</div>
</div>

<!-- ===== RECEIPT ===== -->
<div id="receipt">
<h2>STUDENT FEE RECEIPT</h2>
<hr>

<div class="row"><b>Name:</b><span id="rName"></span></div>
<div class="row"><b>Father Name:</b><span id="rFather"></span></div>
<div class="row"><b>Class:</b><span id="rClass"></span></div>

<hr>

<div class="row"><b>Month:</b><span id="rMonth"></span></div>
<div class="row"><b>Amount:</b><span id="rAmount"></span></div>
<div class="row"><b>Date:</b><span id="rDate"></span></div>

<hr><br>

<div class="row">
<span>Student Signature</span>
<span>Authorized Signature</span>
</div>

<br><br>

<button onclick="window.print()">Print Receipt</button>
</div>

<script>
let students = JSON.parse(localStorage.getItem("students")) || [];
let feesData = JSON.parse(localStorage.getItem("feesData")) || [];

let select = document.getElementById("studentSelect");
select.innerHTML = "<option value=''>-- Select Student --</option>";

students.forEach((s, i) => {
  let opt = document.createElement("option");
  opt.value = i;
  opt.textContent = s.name + " (" + s.class + ")";
  select.appendChild(opt);
});

/* ===== GRAND TOTAL CALCULATION ===== */
function updateGrandTotal() {
  let total = 0;
  feesData.forEach(f => total += Number(f.amount));
  document.getElementById("grandTotal").innerText = total;
}
updateGrandTotal();

function generateReceipt() {
  let idx = select.value;
  let amt = document.getElementById("amount").value;
  let mon = document.getElementById("month").value;

  if (idx === "" || amt === "" || mon === "") {
    alert("Please fill all fields");
    return;
  }

  let student = students[idx];

  /* SAVE FEE DATA */
  feesData.push({
    name: student.name,
    amount: amt
  });
  localStorage.setItem("feesData", JSON.stringify(feesData));
  updateGrandTotal();

  /* RECEIPT DATA */
  document.getElementById("rName").innerText = student.name;
  document.getElementById("rFather").innerText = student.father;
  document.getElementById("rClass").innerText = student.class;
  document.getElementById("rMonth").innerText = mon;
  document.getElementById("rAmount").innerText = "₹ " + amt;
  document.getElementById("rDate").innerText = new Date().toLocaleDateString();

  document.getElementById("receipt").style.display = "block";

  document.getElementById("amount").value="";
  document.getElementById("month").value="";
}
</script>

</body>
</html>
