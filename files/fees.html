<script>
/*
=========================================================
YE INDEPENDENT SCRIPT HAI
JO KI SIRF fees.html KE LIYE HAI
Iska registration ya kisi aur script se
koi sambandh nahi hai
=========================================================
*/

// Auto receipt & date
document.getElementById("rno").value =
  "SVV-" + Date.now().toString().slice(-5);
document.getElementById("rdate").value =
  new Date().toISOString().slice(0, 10);

// üîç Search student from Sheet1
function searchStudent() {
  const name = document.getElementById("searchName").value.trim();
  if (name.length < 2) return;

  google.script.run
    .withSuccessHandler(function (list) {
      const adm = document.getElementById("admno");
      const studentName = document.getElementById("studentName");
      const father = document.getElementById("fatherName");
      const cls = document.getElementById("className");

      if (!list || list.length === 0) {
        adm.value = "";
        studentName.value = "";
        father.value = "";
        cls.value = "";
        return;
      }

      const s = list[0];
      adm.value = s.admno || "";
      studentName.value = s.student_name || "";
      father.value = s.father_name || "";
      cls.value = s.class_name || "";
    })
    .searchStudentFromSheet(name);
}

// üí∞ Fee calculation
function calcFee() {
  const t = Number(document.getElementById("total").value) || 0;
  const p = Number(document.getElementById("paid").value) || 0;
  const r = t - p;

  document.getElementById("received").innerText = p;
  document.getElementById("remain").value = r;
  document.getElementById("remainRow").style.display = r > 0 ? "" : "none";
}

// üíæ Save fees into "fees" sheet
function saveFees() {
  if (!document.getElementById("admno").value) {
    alert("Please search student first");
    return;
  }

  const data = {
    receipt: document.getElementById("rno").value,
    admno: document.getElementById("admno").value,
    name: document.getElementById("studentName").value,
    month: document.getElementById("feeMonth").value,
    total: document.getElementById("total").value,
    paid: document.getElementById("paid").value,
    remain: document.getElementById("remain").value,
    date: document.getElementById("rdate").value
  };

  google.script.run
    .withSuccessHandler(function (msg) {
      alert(msg);
    })
    .withFailureHandler(function (err) {
      alert(err.message);
    })
    .saveFeesData(data);
}
</script>
